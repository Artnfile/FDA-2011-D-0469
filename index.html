<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDA Usability Report - Human Factors Validation</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
        const { useState, useEffect } = React;

        const saveData = (data) => {
            try {
                localStorage.setItem('fda-report-v2', JSON.stringify(data));
                return true;
            } catch (e) {
                alert('Storage error: ' + e.message);
                return false;
            }
        };

        const loadData = () => {
            try {
                const data = localStorage.getItem('fda-report-v2');
                return data ? JSON.parse(data) : null;
            } catch (e) {
                return null;
            }
        };

        function App() {
            const [section, setSection] = useState(1);
            const [projectName, setProjectName] = useState('');
            const [deviceName, setDeviceName] = useState('');
            const [lastSaved, setLastSaved] = useState(null);
            const [sidebarOpen, setSidebarOpen] = useState(false);

            // Section 1
            const [safetyStatement, setSafetyStatement] = useState('');
            const [processSummary, setProcessSummary] = useState('');
            const [residualRisk, setResidualRisk] = useState('');

            // Section 2 - Enhanced
            const [userGroups, setUserGroups] = useState([]);
            const [useEnvironments, setUseEnvironments] = useState([]);
            const [trainingData, setTrainingData] = useState([]);

            // Section 5 - Enhanced
            const [hazards, setHazards] = useState([]);

            // Section 7 - Enhanced
            const [criticalTasks, setCriticalTasks] = useState([]);

            // Section 8 - Enhanced
            const [testEnvironment, setTestEnvironment] = useState('');
            const [participants, setParticipants] = useState([]);
            const [taskPerformance, setTaskPerformance] = useState([]);

            const [completedSections, setCompletedSections] = useState(new Set());

            useEffect(() => {
                const saved = loadData();
                if (saved) {
                    setProjectName(saved.projectName || '');
                    setDeviceName(saved.deviceName || '');
                    setSafetyStatement(saved.safetyStatement || '');
                    setProcessSummary(saved.processSummary || '');
                    setResidualRisk(saved.residualRisk || '');
                    setUserGroups(saved.userGroups || []);
                    setUseEnvironments(saved.useEnvironments || []);
                    setTrainingData(saved.trainingData || []);
                    setHazards(saved.hazards || []);
                    setCriticalTasks(saved.criticalTasks || []);
                    setTestEnvironment(saved.testEnvironment || '');
                    setParticipants(saved.participants || []);
                    setTaskPerformance(saved.taskPerformance || []);
                    setCompletedSections(new Set(saved.completedSections || []));
                    setLastSaved(saved.lastSaved);
                }
            }, []);

            useEffect(() => {
                const timer = setTimeout(() => {
                    handleSave();
                }, 30000);
                return () => clearTimeout(timer);
            });

            const handleSave = () => {
                const data = {
                    projectName, deviceName, safetyStatement, processSummary, residualRisk,
                    userGroups, useEnvironments, trainingData, hazards, criticalTasks,
                    testEnvironment, participants, taskPerformance,
                    completedSections: Array.from(completedSections),
                    lastSaved: new Date().toISOString()
                };
                if (saveData(data)) {
                    setLastSaved(data.lastSaved);
                }
            };

            const toggleComplete = (sectionNum) => {
                const newSet = new Set(completedSections);
                if (newSet.has(sectionNum)) {
                    newSet.delete(sectionNum);
                } else {
                    newSet.add(sectionNum);
                }
                setCompletedSections(newSet);
            };

            // User Group functions
            const addUserGroup = () => {
                setUserGroups([...userGroups, {
                    id: Date.now(),
                    name: '',
                    physical: { height: '', weight: '', strength: '', dexterity: '', mobility: '' },
                    sensory: { visualAcuity: '', colorVision: '', hearing: '', tactile: '' },
                    cognitive: { literacy: '', language: '', healthLiteracy: '', technical: '' },
                    demographics: { ageRange: '', gender: '', education: '', conditions: '' },
                    experience: { deviceFamiliarity: '', frequency: '' }
                }]);
            };

            const updateUserGroup = (id, category, field, value) => {
                setUserGroups(userGroups.map(ug => 
                    ug.id === id ? {
                        ...ug,
                        [category]: typeof ug[category] === 'object' 
                            ? { ...ug[category], [field]: value }
                            : value
                    } : ug
                ));
            };

            const removeUserGroup = (id) => {
                setUserGroups(userGroups.filter(ug => ug.id !== id));
            };

            // Environment functions
            const addEnvironment = () => {
                setUseEnvironments([...useEnvironments, {
                    id: Date.now(),
                    location: '',
                    lighting: '',
                    noise: '',
                    space: '',
                    temperature: '',
                    distractions: '',
                    multitasking: ''
                }]);
            };

            const updateEnvironment = (id, field, value) => {
                setUseEnvironments(useEnvironments.map(env =>
                    env.id === id ? { ...env, [field]: value } : env
                ));
            };

            const removeEnvironment = (id) => {
                setUseEnvironments(useEnvironments.filter(env => env.id !== id));
            };

            // Training functions
            const addTraining = () => {
                setTrainingData([...trainingData, {
                    id: Date.now(),
                    userGroup: '',
                    type: '',
                    content: '',
                    method: '',
                    duration: '',
                    frequency: '',
                    assessment: ''
                }]);
            };

            const updateTraining = (id, field, value) => {
                setTrainingData(trainingData.map(t =>
                    t.id === id ? { ...t, [field]: value } : t
                ));
            };

            const removeTraining = (id) => {
                setTrainingData(trainingData.filter(t => t.id !== id));
            };

            // Hazard functions - Enhanced
            const addHazard = () => {
                setHazards([...hazards, {
                    id: Date.now(),
                    scenario: '',
                    task: '',
                    useError: '',
                    hazard: '',
                    harm: '',
                    initialProbability: 'occasional',
                    initialSeverity: 'serious',
                    initialRisk: '',
                    primaryControls: '',
                    secondaryControls: '',
                    tertiaryControls: '',
                    residualProbability: 'remote',
                    residualSeverity: 'moderate',
                    residualRisk: '',
                    verification: ''
                }]);
            };

            const updateHazard = (id, field, value) => {
                setHazards(hazards.map(h => {
                    if (h.id === id) {
                        const updated = { ...h, [field]: value };
                        // Auto-calculate risk scores
                        if (field === 'initialProbability' || field === 'initialSeverity') {
                            updated.initialRisk = calculateRisk(
                                updated.initialProbability,
                                updated.initialSeverity
                            );
                        }
                        if (field === 'residualProbability' || field === 'residualSeverity') {
                            updated.residualRisk = calculateRisk(
                                updated.residualProbability,
                                updated.residualSeverity
                            );
                        }
                        return updated;
                    }
                    return h;
                }));
            };

            const calculateRisk = (probability, severity) => {
                const probValues = { frequent: 5, probable: 4, occasional: 3, remote: 2, improbable: 1 };
                const sevValues = { catastrophic: 5, serious: 4, moderate: 3, minor: 2, negligible: 1 };
                const score = (probValues[probability] || 0) * (sevValues[severity] || 0);
                if (score >= 15) return 'High';
                if (score >= 8) return 'Medium';
                return 'Low';
            };

            const removeHazard = (id) => {
                setHazards(hazards.filter(h => h.id !== id));
            };

            // Critical Task functions - Enhanced
            const addTask = () => {
                setCriticalTasks([...criticalTasks, {
                    id: Date.now(),
                    taskId: '',
                    name: '',
                    description: '',
                    steps: '',
                    userGroups: '',
                    frequency: '',
                    timeCritical: 'routine',
                    useErrors: '',
                    hazards: '',
                    harms: '',
                    severity: 'serious',
                    controls: '',
                    acceptanceCriteria: ''
                }]);
            };

            const updateTask = (id, field, value) => {
                setCriticalTasks(criticalTasks.map(t =>
                    t.id === id ? { ...t, [field]: value } : t
                ));
            };

            const removeTask = (id) => {
                setCriticalTasks(criticalTasks.filter(t => t.id !== id));
            };

            // Participant functions
            const addParticipant = () => {
                setParticipants([...participants, {
                    id: Date.now(),
                    participantId: '',
                    userGroup: '',
                    age: '',
                    gender: '',
                    education: '',
                    experience: '',
                    conditions: '',
                    physicalChar: '',
                    sensoryChar: '',
                    cognitiveChar: ''
                }]);
            };

            const updateParticipant = (id, field, value) => {
                setParticipants(participants.map(p =>
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const removeParticipant = (id) => {
                setParticipants(participants.filter(p => p.id !== id));
            };

            // Task Performance functions
            const addTaskPerformance = () => {
                setTaskPerformance([...taskPerformance, {
                    id: Date.now(),
                    taskId: '',
                    taskName: '',
                    totalParticipants: '',
                    successes: '',
                    difficulties: '',
                    failures: '',
                    successRate: '',
                    useErrors: '',
                    closeCalls: '',
                    feedback: ''
                }]);
            };

            const updateTaskPerformance = (id, field, value) => {
                setTaskPerformance(taskPerformance.map(tp => {
                    if (tp.id === id) {
                        const updated = { ...tp, [field]: value };
                        // Auto-calculate success rate
                        if (field === 'successes' || field === 'totalParticipants') {
                            const total = parseInt(updated.totalParticipants) || 0;
                            const success = parseInt(updated.successes) || 0;
                            if (total > 0) {
                                updated.successRate = ((success / total) * 100).toFixed(1) + '%';
                            }
                        }
                        return updated;
                    }
                    return tp;
                }));
            };

            const removeTaskPerformance = (id) => {
                setTaskPerformance(taskPerformance.filter(tp => tp.id !== id));
            };

            const exportJSON = () => {
                const data = {
                    projectName, deviceName, safetyStatement, processSummary, residualRisk,
                    userGroups, useEnvironments, trainingData, hazards, criticalTasks,
                    testEnvironment, participants, taskPerformance,
                    exportedAt: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${projectName || 'fda-report'}-${Date.now()}.json`;
                a.click();
            };

            const sections = [
                '1. Conclusion',
                '2. Users, Uses & Environments',
                '3. Device UI Description',
                '4. Known Use Problems',
                '5. Risk Analysis',
                '6. Preliminary Analyses',
                '7. Critical Tasks',
                '8. Validation Testing',
                '9. Documentation',
                '10. Export & Review'
            ];

            const progress = (completedSections.size / 10) * 100;

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-blue-900 text-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-3">
                                    <button 
                                        onClick={() => setSidebarOpen(!sidebarOpen)}
                                        className="lg:hidden p-2 hover:bg-blue-800 rounded"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                        </svg>
                                    </button>
                                    <div>
                                        <h1 className="text-lg sm:text-2xl font-bold">FDA Usability Report</h1>
                                        <p className="text-blue-200 text-xs sm:text-sm hidden sm:block">Phase 2: Enhanced Documentation</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2 sm:gap-4">
                                    {lastSaved && (
                                        <span className="text-xs sm:text-sm text-blue-200 hidden sm:inline">
                                            Saved: {new Date(lastSaved).toLocaleTimeString()}
                                        </span>
                                    )}
                                    <button onClick={handleSave} className="bg-blue-700 px-3 py-2 sm:px-4 rounded hover:bg-blue-600 text-sm sm:text-base">
                                        ðŸ’¾ <span className="hidden sm:inline">Save</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-8">
                        <div className="lg:grid lg:grid-cols-4 lg:gap-6">
                            {/* Mobile Sidebar Overlay */}
                            {sidebarOpen && (
                                <div 
                                    className="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
                                    onClick={() => setSidebarOpen(false)}
                                />
                            )}

                            {/* Sidebar */}
                            <aside className={`
                                fixed lg:static inset-y-0 left-0 z-50
                                w-80 lg:w-auto lg:col-span-1
                                transform transition-transform duration-300 ease-in-out
                                ${sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}
                            `}>
                                <div className="bg-white rounded-lg shadow p-4 h-full lg:sticky lg:top-4 overflow-y-auto">
                                    <button 
                                        onClick={() => setSidebarOpen(false)}
                                        className="lg:hidden absolute top-4 right-4 text-gray-500 hover:text-gray-700"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Project Name</label>
                                        <input
                                            value={projectName}
                                            onChange={(e) => setProjectName(e.target.value)}
                                            className="w-full p-2 border rounded text-sm sm:text-base"
                                            placeholder="Project name"
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Device Name</label>
                                        <input
                                            value={deviceName}
                                            onChange={(e) => setDeviceName(e.target.value)}
                                            className="w-full p-2 border rounded text-sm sm:text-base"
                                            placeholder="Device name"
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <div className="flex justify-between text-sm mb-1">
                                            <span>Progress</span>
                                            <span>{completedSections.size}/10</span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                            <div className="bg-blue-600 h-2 rounded-full transition-all" style={{width: `${progress}%`}}></div>
                                        </div>
                                    </div>
                                    <nav className="space-y-1">
                                        {sections.map((s, i) => (
                                            <button
                                                key={i}
                                                onClick={() => {
                                                    setSection(i + 1);
                                                    setSidebarOpen(false);
                                                }}
                                                className={`w-full text-left p-3 sm:p-2 rounded text-sm flex justify-between items-center ${
                                                    section === i + 1 ? 'bg-blue-100 text-blue-700 font-medium' : 'hover:bg-gray-100'
                                                }`}
                                            >
                                                <span>{s}</span>
                                                {completedSections.has(i + 1) && <span className="text-green-600">âœ“</span>}
                                            </button>
                                        ))}
                                    </nav>
                                    <button onClick={exportJSON} className="w-full mt-4 bg-gray-200 p-3 sm:p-2 rounded hover:bg-gray-300 text-sm">
                                        ðŸ“¥ Export JSON
                                    </button>
                                </div>
                            </aside>

                            {/* Main Content */}
                            <main className="lg:col-span-3 mt-4 lg:mt-0">
                                <div className="bg-white rounded-lg shadow p-4 sm:p-6">
                                    <div className="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4 mb-6">
                                        <div>
                                            <h2 className="text-xl sm:text-2xl font-bold text-gray-900">{sections[section - 1]}</h2>
                                            <p className="text-xs sm:text-sm text-gray-600 mt-1">FDA Guidance Requirements - Phase 2 Enhanced</p>
                                        </div>
                                        <button
                                            onClick={() => toggleComplete(section)}
                                            className={`px-4 py-2 rounded text-sm whitespace-nowrap ${
                                                completedSections.has(section)
                                                    ? 'bg-green-100 text-green-700'
                                                    : 'bg-gray-100 text-gray-700'
                                            }`}
                                        >
                                            {completedSections.has(section) ? 'âœ“ Completed' : 'Mark Complete'}
                                        </button>
                                    </div>

                                    {/* Section 1: Conclusion */}
                                    {section === 1 && (
                                        <div className="space-y-4 sm:space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-3 sm:p-4">
                                                <p className="text-xs sm:text-sm"><strong>FDA Requirement:</strong> Provide conclusion that device is safe and effective for intended users, uses, and use environments.</p>
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2 text-sm sm:text-base">1.1 Safety & Effectiveness Statement</label>
                                                <textarea
                                                    value={safetyStatement}
                                                    onChange={(e) => setSafetyStatement(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px] text-sm sm:text-base"
                                                    placeholder="State that the device has been found to be safe and effective..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2 text-sm sm:text-base">1.2 HFE/UE Process Summary</label>
                                                <textarea
                                                    value={processSummary}
                                                    onChange={(e) => setProcessSummary(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px] text-sm sm:text-base"
                                                    placeholder="Summarize the HFE/UE processes conducted..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2 text-sm sm:text-base">1.3 Residual Risk Discussion</label>
                                                <textarea
                                                    value={residualRisk}
                                                    onChange={(e) => setResidualRisk(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px] text-sm sm:text-base"
                                                    placeholder="Discuss any remaining use-related risks..."
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {/* Section 2: Users, Uses, Environments - ENHANCED */}
                                    {section === 2 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-3 sm:p-4">
                                                <p className="text-xs sm:text-sm"><strong>FDA Requirement:</strong> Document all user populations with detailed characteristics, use environments, and training requirements.</p>
                                            </div>

                                            {/* 2.1 User Populations */}
                                            <div className="border-t pt-4">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h3 className="font-semibold text-lg">2.1 User Populations</h3>
                                                    <button onClick={addUserGroup} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add User Group</button>
                                                </div>
                                                {userGroups.map((ug) => (
                                                    <div key={ug.id} className="border rounded-lg p-4 mb-4 bg-gray-50">
                                                        <div className="flex justify-between mb-3">
                                                            <input
                                                                value={ug.name}
                                                                onChange={(e) => updateUserGroup(ug.id, 'name', null, e.target.value)}
                                                                className="font-medium p-2 border rounded flex-1 mr-2"
                                                                placeholder="User Group Name (e.g., Physicians, Nurses)"
                                                            />
                                                            <button onClick={() => removeUserGroup(ug.id)} className="text-red-600 px-2 text-xl">âœ•</button>
                                                        </div>

                                                        <div className="space-y-4">
                                                            <div>
                                                                <p className="font-medium text-sm mb-2">Physical Capabilities</p>
                                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                                    <input
                                                                        value={ug.physical.height}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'physical', 'height', e.target.value)}
                                                                        placeholder="Height range"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.physical.weight}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'physical', 'weight', e.target.value)}
                                                                        placeholder="Weight range"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.physical.strength}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'physical', 'strength', e.target.value)}
                                                                        placeholder="Strength (grip, etc.)"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.physical.dexterity}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'physical', 'dexterity', e.target.value)}
                                                                        placeholder="Dexterity/fine motor"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.physical.mobility}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'physical', 'mobility', e.target.value)}
                                                                        placeholder="Mobility limitations"
                                                                        className="p-2 border rounded text-sm col-span-1 sm:col-span-2"
                                                                    />
                                                                </div>
                                                            </div>

                                                            <div>
                                                                <p className="font-medium text-sm mb-2">Sensory Abilities</p>
                                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                                    <input
                                                                        value={ug.sensory.visualAcuity}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'sensory', 'visualAcuity', e.target.value)}
                                                                        placeholder="Visual acuity"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.sensory.colorVision}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'sensory', 'colorVision', e.target.value)}
                                                                        placeholder="Color vision"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.sensory.hearing}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'sensory', 'hearing', e.target.value)}
                                                                        placeholder="Hearing ability"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.sensory.tactile}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'sensory', 'tactile', e.target.value)}
                                                                        placeholder="Tactile sensitivity"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                </div>
                                                            </div>

                                                            <div>
                                                                <p className="font-medium text-sm mb-2">Cognitive Abilities</p>
                                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                                    <input
                                                                        value={ug.cognitive.literacy}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'cognitive', 'literacy', e.target.value)}
                                                                        placeholder="Literacy level"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.cognitive.language}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'cognitive', 'language', e.target.value)}
                                                                        placeholder="Language proficiency"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.cognitive.healthLiteracy}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'cognitive', 'healthLiteracy', e.target.value)}
                                                                        placeholder="Health literacy"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.cognitive.technical}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'cognitive', 'technical', e.target.value)}
                                                                        placeholder="Technical aptitude"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                </div>
                                                            </div>

                                                            <div>
                                                                <p className="font-medium text-sm mb-2">Demographics</p>
                                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                                    <input
                                                                        value={ug.demographics.ageRange}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'demographics', 'ageRange', e.target.value)}
                                                                        placeholder="Age range"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.demographics.gender}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'demographics', 'gender', e.target.value)}
                                                                        placeholder="Gender distribution"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.demographics.education}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'demographics', 'education', e.target.value)}
                                                                        placeholder="Education level"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.demographics.conditions}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'demographics', 'conditions', e.target.value)}
                                                                        placeholder="Medical conditions"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                </div>
                                                            </div>

                                                            <div>
                                                                <p className="font-medium text-sm mb-2">Experience</p>
                                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                                    <input
                                                                        value={ug.experience.deviceFamiliarity}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'experience', 'deviceFamiliarity', e.target.value)}
                                                                        placeholder="Device familiarity"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                    <input
                                                                        value={ug.experience.frequency}
                                                                        onChange={(e) => updateUserGroup(ug.id, 'experience', 'frequency', e.target.value)}
                                                                        placeholder="Frequency of use"
                                                                        className="p-2 border rounded text-sm"
                                                                    />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* 2.3 Use Environments */}
                                            <div className="border-t pt-4">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h3 className="font-semibold text-lg">2.3 Use Environments</h3>
                                                    <button onClick={addEnvironment} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add Environment</button>
                                                </div>
                                                {useEnvironments.map((env) => (
                                                    <div key={env.id} className="border rounded-lg p-4 mb-3 bg-gray-50">
                                                        <div className="flex justify-between mb-3">
                                                            <input
                                                                value={env.location}
                                                                onChange={(e) => updateEnvironment(env.id, 'location', e.target.value)}
                                                                placeholder="Location (e.g., Hospital OR, Home, Ambulance)"
                                                                className="font-medium p-2 border rounded flex-1 mr-2"
                                                            />
                                                            <button onClick={() => removeEnvironment(env.id)} className="text-red-600 px-2 text-xl">âœ•</button>
                                                        </div>
                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                            <input
                                                                value={env.lighting}
                                                                onChange={(e) => updateEnvironment(env.id, 'lighting', e.target.value)}
                                                                placeholder="Lighting (lux levels, conditions)"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={env.noise}
                                                                onChange={(e) => updateEnvironment(env.id, 'noise', e.target.value)}
                                                                placeholder="Noise levels (dB)"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={env.space}
                                                                onChange={(e) => updateEnvironment(env.id, 'space', e.target.value)}
                                                                placeholder="Space constraints"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={env.temperature}
                                                                onChange={(e) => updateEnvironment(env.id, 'temperature', e.target.value)}
                                                                placeholder="Temperature/Humidity"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={env.distractions}
                                                                onChange={(e) => updateEnvironment(env.id, 'distractions', e.target.value)}
                                                                placeholder="Distractions/Interruptions"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={env.multitasking}
                                                                onChange={(e) => updateEnvironment(env.id, 'multitasking', e.target.value)}
                                                                placeholder="Multitasking requirements"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* 2.4 Training */}
                                            <div className="border-t pt-4">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h3 className="font-semibold text-lg">2.4 Training Requirements</h3>
                                                    <button onClick={addTraining} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add Training</button>
                                                </div>
                                                {trainingData.map((t) => (
                                                    <div key={t.id} className="border rounded-lg p-4 mb-3 bg-gray-50">
                                                        <div className="flex justify-between mb-3">
                                                            <input
                                                                value={t.userGroup}
                                                                onChange={(e) => updateTraining(t.id, 'userGroup', e.target.value)}
                                                                placeholder="User Group"
                                                                className="font-medium p-2 border rounded flex-1 mr-2"
                                                            />
                                                            <button onClick={() => removeTraining(t.id)} className="text-red-600 px-2 text-xl">âœ•</button>
                                                        </div>
                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                            <input
                                                                value={t.type}
                                                                onChange={(e) => updateTraining(t.id, 'type', e.target.value)}
                                                                placeholder="Training type"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={t.method}
                                                                onChange={(e) => updateTraining(t.id, 'method', e.target.value)}
                                                                placeholder="Delivery method (hands-on, video, manual)"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={t.duration}
                                                                onChange={(e) => updateTraining(t.id, 'duration', e.target.value)}
                                                                placeholder="Duration"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={t.frequency}
                                                                onChange={(e) => updateTraining(t.id, 'frequency', e.target.value)}
                                                                placeholder="Refresher frequency"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <textarea
                                                                value={t.content}
                                                                onChange={(e) => updateTraining(t.id, 'content', e.target.value)}
                                                                placeholder="Training content description..."
                                                                className="p-2 border rounded text-sm col-span-1 sm:col-span-2"
                                                                rows="2"
                                                            />
                                                            <input
                                                                value={t.assessment}
                                                                onChange={(e) => updateTraining(t.id, 'assessment', e.target.value)}
                                                                placeholder="Assessment method"
                                                                className="p-2 border rounded text-sm col-span-1 sm:col-span-2"
                                                            />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* SECTION 5: Risk Analysis - ENHANCED */}
                                    {section === 5 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-3 sm:p-4">
                                                <p className="text-xs sm:text-sm"><strong>FDA Requirement:</strong> Comprehensive risk analysis with probability, severity, controls, and residual risk assessment.</p>
                                            </div>

                                            <div className="bg-amber-50 border border-amber-200 rounded p-3 text-sm">
                                                <p className="font-medium mb-2">Risk Scoring Guide:</p>
                                                <p><strong>Probability:</strong> Frequent (5), Probable (4), Occasional (3), Remote (2), Improbable (1)</p>
                                                <p><strong>Severity:</strong> Catastrophic (5), Serious (4), Moderate (3), Minor (2), Negligible (1)</p>
                                                <p><strong>Risk Level:</strong> High (15-25), Medium (8-14), Low (1-7)</p>
                                            </div>

                                            <div className="flex justify-between items-center">
                                                <h3 className="font-semibold text-lg">5.1 Risk Analysis Table</h3>
                                                <button onClick={addHazard} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add Hazard</button>
                                            </div>

                                            {hazards.map((h) => (
                                                <div key={h.id} className="border-2 rounded-lg p-4 bg-gray-50">
                                                    <div className="flex justify-between mb-3">
                                                        <h4 className="font-medium">Hazard Analysis</h4>
                                                        <button onClick={() => removeHazard(h.id)} className="text-red-600 text-xl">âœ•</button>
                                                    </div>

                                                    <div className="space-y-3">
                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                            <input
                                                                value={h.scenario}
                                                                onChange={(e) => updateHazard(h.id, 'scenario', e.target.value)}
                                                                placeholder="Use scenario"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={h.task}
                                                                onChange={(e) => updateHazard(h.id, 'task', e.target.value)}
                                                                placeholder="Task/sub-task involved"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                        </div>

                                                        <textarea
                                                            value={h.useError}
                                                            onChange={(e) => updateHazard(h.id, 'useError', e.target.value)}
                                                            placeholder="Use error description..."
                                                            className="w-full p-2 border rounded text-sm"
                                                            rows="2"
                                                        />

                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                            <textarea
                                                                value={h.hazard}
                                                                onChange={(e) => updateHazard(h.id, 'hazard', e.target.value)}
                                                                placeholder="Hazardous situation..."
                                                                className="p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                            <textarea
                                                                value={h.harm}
                                                                onChange={(e) => updateHazard(h.id, 'harm', e.target.value)}
                                                                placeholder="Potential harm..."
                                                                className="p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                        </div>

                                                        <div className="bg-white border-2 rounded p-3">
                                                            <p className="font-medium text-sm mb-2">Initial Risk (Before Controls)</p>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                <select
                                                                    value={h.initialProbability}
                                                                    onChange={(e) => updateHazard(h.id, 'initialProbability', e.target.value)}
                                                                    className="p-2 border rounded text-sm"
                                                                >
                                                                    <option value="frequent">Frequent (5)</option>
                                                                    <option value="probable">Probable (4)</option>
                                                                    <option value="occasional">Occasional (3)</option>
                                                                    <option value="remote">Remote (2)</option>
                                                                    <option value="improbable">Improbable (1)</option>
                                                                </select>
                                                                <select
                                                                    value={h.initialSeverity}
                                                                    onChange={(e) => updateHazard(h.id, 'initialSeverity', e.target.value)}
                                                                    className="p-2 border rounded text-sm"
                                                                >
                                                                    <option value="catastrophic">Catastrophic (5)</option>
                                                                    <option value="serious">Serious (4)</option>
                                                                    <option value="moderate">Moderate (3)</option>
                                                                    <option value="minor">Minor (2)</option>
                                                                    <option value="negligible">Negligible (1)</option>
                                                                </select>
                                                                <input
                                                                    value={h.initialRisk}
                                                                    readOnly
                                                                    placeholder="Risk Level"
                                                                    className="p-2 border rounded text-sm bg-gray-100 font-medium"
                                                                />
                                                            </div>
                                                        </div>

                                                        <div className="space-y-2">
                                                            <textarea
                                                                value={h.primaryControls}
                                                                onChange={(e) => updateHazard(h.id, 'primaryControls', e.target.value)}
                                                                placeholder="Primary controls (inherent safety by design)..."
                                                                className="w-full p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                            <textarea
                                                                value={h.secondaryControls}
                                                                onChange={(e) => updateHazard(h.id, 'secondaryControls', e.target.value)}
                                                                placeholder="Secondary controls (protective measures)..."
                                                                className="w-full p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                            <textarea
                                                                value={h.tertiaryControls}
                                                                onChange={(e) => updateHazard(h.id, 'tertiaryControls', e.target.value)}
                                                                placeholder="Tertiary controls (information for safety: labels, IFU, training)..."
                                                                className="w-full p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                        </div>

                                                        <div className="bg-green-50 border-2 border-green-200 rounded p-3">
                                                            <p className="font-medium text-sm mb-2">Residual Risk (After Controls)</p>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                <select
                                                                    value={h.residualProbability}
                                                                    onChange={(e) => updateHazard(h.id, 'residualProbability', e.target.value)}
                                                                    className="p-2 border rounded text-sm"
                                                                >
                                                                    <option value="frequent">Frequent (5)</option>
                                                                    <option value="probable">Probable (4)</option>
                                                                    <option value="occasional">Occasional (3)</option>
                                                                    <option value="remote">Remote (2)</option>
                                                                    <option value="improbable">Improbable (1)</option>
                                                                </select>
                                                                <select
                                                                    value={h.residualSeverity}
                                                                    onChange={(e) => updateHazard(h.id, 'residualSeverity', e.target.value)}
                                                                    className="p-2 border rounded text-sm"
                                                                >
                                                                    <option value="catastrophic">Catastrophic (5)</option>
                                                                    <option value="serious">Serious (4)</option>
                                                                    <option value="moderate">Moderate (3)</option>
                                                                    <option value="minor">Minor (2)</option>
                                                                    <option value="negligible">Negligible (1)</option>
                                                                </select>
                                                                <input
                                                                    value={h.residualRisk}
                                                                    readOnly
                                                                    placeholder="Risk Level"
                                                                    className="p-2 border rounded text-sm bg-green-100 font-medium"
                                                                />
                                                            </div>
                                                        </div>

                                                        <textarea
                                                            value={h.verification}
                                                            onChange={(e) => updateHazard(h.id, 'verification', e.target.value)}
                                                            placeholder="Verification evidence (testing, analysis, documentation)..."
                                                            className="w-full p-2 border rounded text-sm"
                                                            rows="2"
                                                        />
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* SECTION 7: Critical Tasks - ENHANCED */}
                                    {section === 7 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-3 sm:p-4">
                                                <p className="text-xs sm:text-sm"><strong>FDA Requirement:</strong> Identify all critical tasks with detailed documentation of steps, use errors, harms, and acceptance criteria.</p>
                                            </div>

                                            <div className="flex justify-between items-center">
                                                <h3 className="font-semibold text-lg">7.1 Critical Tasks List</h3>
                                                <button onClick={addTask} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add Critical Task</button>
                                            </div>

                                            {criticalTasks.map((task) => (
                                                <div key={task.id} className="border-2 rounded-lg p-4 bg-gray-50">
                                                    <div className="flex justify-between mb-3">
                                                        <div className="flex gap-2 flex-1">
                                                            <input
                                                                value={task.taskId}
                                                                onChange={(e) => updateTask(task.id, 'taskId', e.target.value)}
                                                                placeholder="Task ID"
                                                                className="w-24 p-2 border rounded text-sm font-medium"
                                                            />
                                                            <input
                                                                value={task.name}
                                                                onChange={(e) => updateTask(task.id, 'name', e.target.value)}
                                                                placeholder="Task name"
                                                                className="flex-1 p-2 border rounded text-sm font-medium"
                                                            />
                                                        </div>
                                                        <button onClick={() => removeTask(task.id)} className="text-red-600 px-2 text-xl">âœ•</button>
                                                    </div>

                                                    <div className="space-y-3">
                                                        <textarea
                                                            value={task.description}
                                                            onChange={(e) => updateTask(task.id, 'description', e.target.value)}
                                                            placeholder="Detailed task description..."
                                                            className="w-full p-2 border rounded text-sm"
                                                            rows="2"
                                                        />

                                                        <textarea
                                                            value={task.steps}
                                                            onChange={(e) => updateTask(task.id, 'steps', e.target.value)}
                                                            placeholder="Task steps (numbered)...&#10;1. First step&#10;2. Second step&#10;3. Third step"
                                                            className="w-full p-2 border rounded text-sm font-mono"
                                                            rows="4"
                                                        />

                                                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-2">
                                                            <input
                                                                value={task.userGroups}
                                                                onChange={(e) => updateTask(task.id, 'userGroups', e.target.value)}
                                                                placeholder="User group(s)"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={task.frequency}
                                                                onChange={(e) => updateTask(task.id, 'frequency', e.target.value)}
                                                                placeholder="Frequency (daily, weekly, etc.)"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <select
                                                                value={task.timeCritical}
                                                                onChange={(e) => updateTask(task.id, 'timeCritical', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                            >
                                                                <option value="routine">Routine</option>
                                                                <option value="urgent">Urgent</option>
                                                                <option value="emergency">Emergency</option>
                                                            </select>
                                                        </div>

                                                        <textarea
                                                            value={task.useErrors}
                                                            onChange={(e) => updateTask(task.id, 'useErrors', e.target.value)}
                                                            placeholder="Potential use errors (list all possible errors for this task)..."
                                                            className="w-full p-2 border rounded text-sm"
                                                            rows="3"
                                                        />

                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                            <textarea
                                                                value={task.hazards}
                                                                onChange={(e) => updateTask(task.id, 'hazards', e.target.value)}
                                                                placeholder="Hazardous situations..."
                                                                className="p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                            <textarea
                                                                value={task.harms}
                                                                onChange={(e) => updateTask(task.id, 'harms', e.target.value)}
                                                                placeholder="Potential harms..."
                                                                className="p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                        </div>

                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                            <select
                                                                value={task.severity}
                                                                onChange={(e) => updateTask(task.id, 'severity', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                            >
                                                                <option value="">Select severity...</option>
                                                                <option value="catastrophic">Catastrophic</option>
                                                                <option value="serious">Serious</option>
                                                                <option value="moderate">Moderate</option>
                                                                <option value="minor">Minor</option>
                                                            </select>
                                                            <textarea
                                                                value={task.controls}
                                                                onChange={(e) => updateTask(task.id, 'controls', e.target.value)}
                                                                placeholder="Risk control measures..."
                                                                className="p-2 border rounded text-sm"
                                                                rows="2"
                                                            />
                                                        </div>

                                                        <textarea
                                                            value={task.acceptanceCriteria}
                                                            onChange={(e) => updateTask(task.id, 'acceptanceCriteria', e.target.value)}
                                                            placeholder="Acceptance criteria for validation testing (e.g., '95% task success rate', 'No critical use errors observed')..."
                                                            className="w-full p-2 border rounded text-sm"
                                                            rows="2"
                                                        />
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* SECTION 8: Validation Testing - ENHANCED */}
                                    {section === 8 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-3 sm:p-4">
                                                <p className="text-xs sm:text-sm"><strong>FDA Requirement:</strong> Minimum 15 participants per user group. Document demographics, test environment, task performance, and use errors.</p>
                                            </div>

                                            {/* 8.1 Test Environment */}
                                            <div>
                                                <h3 className="font-semibold text-lg mb-3">8.1 Test Environment & Conditions</h3>
                                                <textarea
                                                    value={testEnvironment}
                                                    onChange={(e) => setTestEnvironment(e.target.value)}
                                                    placeholder="Describe test environment: physical setup, lighting, noise, space, props, equipment, realism assessment..."
                                                    className="w-full p-3 border rounded text-sm"
                                                    rows="4"
                                                />
                                            </div>

                                            {/* 8.2 Test Participants */}
                                            <div className="border-t pt-4">
                                                <div className="flex justify-between items-center mb-3">
                                                    <div>
                                                        <h3 className="font-semibold text-lg">8.2 Test Participants</h3>
                                                        <p className="text-sm text-gray-600">Minimum 15 per distinct user group</p>
                                                    </div>
                                                    <button onClick={addParticipant} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add Participant</button>
                                                </div>
                                                
                                                <div className="mb-3 bg-amber-50 border border-amber-200 rounded p-3 text-sm">
                                                    <p><strong>Total Participants:</strong> {participants.length}</p>
                                                    {participants.length < 15 && (
                                                        <p className="text-amber-700 mt-1">âš  FDA requires minimum 15 participants per user group</p>
                                                    )}
                                                </div>

                                                {participants.map((p) => (
                                                    <div key={p.id} className="border rounded-lg p-4 mb-3 bg-gray-50">
                                                        <div className="flex justify-between mb-3">
                                                            <div className="flex gap-2 flex-1">
                                                                <input
                                                                    value={p.participantId}
                                                                    onChange={(e) => updateParticipant(p.id, 'participantId', e.target.value)}
                                                                    placeholder="P-01"
                                                                    className="w-20 p-2 border rounded text-sm font-medium"
                                                                />
                                                                <input
                                                                    value={p.userGroup}
                                                                    onChange={(e) => updateParticipant(p.id, 'userGroup', e.target.value)}
                                                                    placeholder="User group"
                                                                    className="flex-1 p-2 border rounded text-sm"
                                                                />
                                                            </div>
                                                            <button onClick={() => removeParticipant(p.id)} className="text-red-600 px-2 text-xl">âœ•</button>
                                                        </div>
                                                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                                            <input
                                                                value={p.age}
                                                                onChange={(e) => updateParticipant(p.id, 'age', e.target.value)}
                                                                placeholder="Age"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={p.gender}
                                                                onChange={(e) => updateParticipant(p.id, 'gender', e.target.value)}
                                                                placeholder="Gender"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={p.education}
                                                                onChange={(e) => updateParticipant(p.id, 'education', e.target.value)}
                                                                placeholder="Education"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={p.experience}
                                                                onChange={(e) => updateParticipant(p.id, 'experience', e.target.value)}
                                                                placeholder="Experience"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                        </div>
                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
                                                            <input
                                                                value={p.conditions}
                                                                onChange={(e) => updateParticipant(p.id, 'conditions', e.target.value)}
                                                                placeholder="Medical conditions (if relevant)"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={p.physicalChar}
                                                                onChange={(e) => updateParticipant(p.id, 'physicalChar', e.target.value)}
                                                                placeholder="Physical characteristics"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={p.sensoryChar}
                                                                onChange={(e) => updateParticipant(p.id, 'sensoryChar', e.target.value)}
                                                                placeholder="Sensory characteristics"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={p.cognitiveChar}
                                                                onChange={(e) => updateParticipant(p.id, 'cognitiveChar', e.target.value)}
                                                                placeholder="Cognitive characteristics"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* 8.3 Task Performance Results */}
                                            <div className="border-t pt-4">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h3 className="font-semibold text-lg">8.3 Task Performance Results</h3>
                                                    <button onClick={addTaskPerformance} className="bg-blue-600 text-white px-3 py-2 rounded text-sm">+ Add Task Result</button>
                                                </div>
                                                {taskPerformance.map((tp) => (
                                                    <div key={tp.id} className="border rounded-lg p-4 mb-3 bg-gray-50">
                                                        <div className="flex justify-between mb-3">
                                                            <div className="flex gap-2 flex-1">
                                                                <input
                                                                    value={tp.taskId}
                                                                    onChange={(e) => updateTaskPerformance(tp.id, 'taskId', e.target.value)}
                                                                    placeholder="Task ID"
                                                                    className="w-24 p-2 border rounded text-sm font-medium"
                                                                />
                                                                <input
                                                                    value={tp.taskName}
                                                                    onChange={(e) => updateTaskPerformance(tp.id, 'taskName', e.target.value)}
                                                                    placeholder="Task name"
                                                                    className="flex-1 p-2 border rounded text-sm font-medium"
                                                                />
                                                            </div>
                                                            <button onClick={() => removeTaskPerformance(tp.id)} className="text-red-600 px-2 text-xl">âœ•</button>
                                                        </div>
                                                        <div className="grid grid-cols-2 sm:grid-cols-5 gap-2 mb-2">
                                                            <input
                                                                type="number"
                                                                value={tp.totalParticipants}
                                                                onChange={(e) => updateTaskPerformance(tp.id, 'totalParticipants', e.target.value)}
                                                                placeholder="Total n"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                type="number"
                                                                value={tp.successes}
                                                                onChange={(e) => updateTaskPerformance(tp.id, 'successes', e.target.value)}
                                                                placeholder="Successes"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                type="number"
                                                                value={tp.difficulties}
                                                                onChange={(e) => updateTaskPerformance(tp.id, 'difficulties', e.target.value)}
                                                                placeholder="Difficulties"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                type="number"
                                                                value={tp.failures}
                                                                onChange={(e) => updateTaskPerformance(tp.id, 'failures', e.target.value)}
                                                                placeholder="Failures"
                                                                className="p-2 border rounded text-sm"
                                                            />
                                                            <input
                                                                value={tp.successRate}
                                                                readOnly
                                                                placeholder="Success %"
                                                                className="p-2 border rounded text-sm bg-green-50 font-medium"
                                                            />
                                                        </div>
                                                        <textarea
                                                            value={tp.useErrors}
                                                            onChange={(e) => updateTaskPerformance(tp.id, 'useErrors', e.target.value)}
                                                            placeholder="Use errors observed (describe each error, frequency, participants involved)..."
                                                            className="w-full p-2 border rounded text-sm mb-2"
                                                            rows="2"
                                                        />
                                                        <textarea
                                                            value={tp.closeCalls}
                                                            onChange={(e) => updateTaskPerformance(tp.id, 'closeCalls', e.target.value)}
                                                            placeholder="Close calls (near misses that were caught before harm)..."
                                                            className="w-full p-2 border rounded text-sm mb-2"
                                                            rows="2"
                                                        />
                                                        <textarea
                                                            value={tp.feedback}
                                                            onChange={(e) => updateTaskPerformance(tp.id, 'feedback', e.target.value)}
                                                            placeholder="Participant feedback and observations..."
                                                            className="w-full p-2 border rounded text-sm"
                                                            rows="2"
                                                        />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Other sections placeholder */}
                                    {[3, 4, 6, 9, 10].includes(section) && (
                                        <div className="text-center py-8 sm:py-12">
                                            <div className="text-gray-400 mb-4 text-5xl sm:text-6xl">ðŸ“‹</div>
                                            <h3 className="text-lg sm:text-xl font-medium text-gray-700 mb-2">{sections[section - 1]}</h3>
                                            <p className="text-sm sm:text-base text-gray-500 mb-6">This section will be implemented in Phase 3</p>
                                            <textarea
                                                className="w-full max-w-2xl mx-auto p-3 border rounded min-h-[200px] text-sm sm:text-base"
                                                placeholder="Enter notes for this section..."
                                            />
                                        </div>
                                    )}

                                    {/* Navigation */}
                                    <div className="mt-6 sm:mt-8 pt-4 sm:pt-6 border-t flex justify-between gap-2">
                                        <button
                                            onClick={() => setSection(Math.max(1, section - 1))}
                                            disabled={section === 1}
                                            className="px-4 py-3 sm:py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50 text-sm sm:text-base"
                                        >
                                            â† <span className="hidden sm:inline">Previous</span>
                                        </button>
                                        <button
                                            onClick={() => setSection(Math.min(10, section + 1))}
                                            disabled={section === 10}
                                            className="px-4 py-3 sm:py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 text-sm sm:text-base"
                                        >
                                            <span className="hidden sm:inline">Next</span> â†’
                                        </button>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

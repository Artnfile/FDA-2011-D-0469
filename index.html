<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDA Usability Report - Human Factors Validation</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
        const { useState, useEffect } = React;

        // Helper functions
        const saveData = (data) => {
            try {
                localStorage.setItem('fda-report', JSON.stringify(data));
                return true;
            } catch (e) {
                alert('Storage error: ' + e.message);
                return false;
            }
        };

        const loadData = () => {
            try {
                const data = localStorage.getItem('fda-report');
                return data ? JSON.parse(data) : null;
            } catch (e) {
                return null;
            }
        };

        function App() {
            const [section, setSection] = useState(1);
            const [projectName, setProjectName] = useState('');
            const [deviceName, setDeviceName] = useState('');
            const [lastSaved, setLastSaved] = useState(null);

            // Section 1: Conclusion
            const [safetyStatement, setSafetyStatement] = useState('');
            const [processSummary, setProcessSummary] = useState('');
            const [residualRisk, setResidualRisk] = useState('');

            // Section 2: Users, Uses, Environments
            const [userGroups, setUserGroups] = useState([]);
            const [useEnvironments, setUseEnvironments] = useState([]);
            const [trainingInfo, setTrainingInfo] = useState('');

            // Section 5: Risk Analysis
            const [hazards, setHazards] = useState([]);

            // Section 7: Critical Tasks
            const [criticalTasks, setCriticalTasks] = useState([]);

            // Section 8: Validation Testing
            const [testParticipants, setTestParticipants] = useState('15');
            const [participantDemo, setParticipantDemo] = useState('');
            const [testResults, setTestResults] = useState('');

            // Completion tracking
            const [completedSections, setCompletedSections] = useState(new Set());

            // Load saved data
            useEffect(() => {
                const saved = loadData();
                if (saved) {
                    setProjectName(saved.projectName || '');
                    setDeviceName(saved.deviceName || '');
                    setSafetyStatement(saved.safetyStatement || '');
                    setProcessSummary(saved.processSummary || '');
                    setResidualRisk(saved.residualRisk || '');
                    setUserGroups(saved.userGroups || []);
                    setUseEnvironments(saved.useEnvironments || []);
                    setTrainingInfo(saved.trainingInfo || '');
                    setHazards(saved.hazards || []);
                    setCriticalTasks(saved.criticalTasks || []);
                    setTestParticipants(saved.testParticipants || '15');
                    setParticipantDemo(saved.participantDemo || '');
                    setTestResults(saved.testResults || '');
                    setCompletedSections(new Set(saved.completedSections || []));
                    setLastSaved(saved.lastSaved);
                }
            }, []);

            // Auto-save
            useEffect(() => {
                const timer = setTimeout(() => {
                    handleSave();
                }, 30000);
                return () => clearTimeout(timer);
            });

            const handleSave = () => {
                const data = {
                    projectName, deviceName, safetyStatement, processSummary, residualRisk,
                    userGroups, useEnvironments, trainingInfo, hazards, criticalTasks,
                    testParticipants, participantDemo, testResults,
                    completedSections: Array.from(completedSections),
                    lastSaved: new Date().toISOString()
                };
                if (saveData(data)) {
                    setLastSaved(data.lastSaved);
                }
            };

            const toggleComplete = (sectionNum) => {
                const newSet = new Set(completedSections);
                if (newSet.has(sectionNum)) {
                    newSet.delete(sectionNum);
                } else {
                    newSet.add(sectionNum);
                }
                setCompletedSections(newSet);
            };

            const addUserGroup = () => {
                setUserGroups([...userGroups, {
                    id: Date.now(),
                    name: '',
                    physical: '',
                    sensory: '',
                    cognitive: '',
                    age: '',
                    experience: ''
                }]);
            };

            const updateUserGroup = (id, field, value) => {
                setUserGroups(userGroups.map(ug =>
                    ug.id === id ? {...ug, [field]: value} : ug
                ));
            };

            const removeUserGroup = (id) => {
                setUserGroups(userGroups.filter(ug => ug.id !== id));
            };

            const addHazard = () => {
                setHazards([...hazards, {
                    id: Date.now(),
                    useError: '',
                    hazard: '',
                    harm: '',
                    severity: 'serious',
                    controls: '',
                    residual: ''
                }]);
            };

            const updateHazard = (id, field, value) => {
                setHazards(hazards.map(h =>
                    h.id === id ? {...h, [field]: value} : h
                ));
            };

            const removeHazard = (id) => {
                setHazards(hazards.filter(h => h.id !== id));
            };

            const addTask = () => {
                setCriticalTasks([...criticalTasks, {
                    id: Date.now(),
                    name: '',
                    description: '',
                    userGroup: '',
                    useErrors: '',
                    harm: '',
                    severity: 'serious'
                }]);
            };

            const updateTask = (id, field, value) => {
                setCriticalTasks(criticalTasks.map(t =>
                    t.id === id ? {...t, [field]: value} : t
                ));
            };

            const removeTask = (id) => {
                setCriticalTasks(criticalTasks.filter(t => t.id !== id));
            };

            const exportJSON = () => {
                const data = {
                    projectName, deviceName, safetyStatement, processSummary, residualRisk,
                    userGroups, useEnvironments, trainingInfo, hazards, criticalTasks,
                    testParticipants, participantDemo, testResults,
                    exportedAt: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${projectName || 'fda-report'}-${Date.now()}.json`;
                a.click();
            };

            const sections = [
                '1. Conclusion',
                '2. Users, Uses & Environments',
                '3. Device UI Description',
                '4. Known Use Problems',
                '5. Risk Analysis',
                '6. Preliminary Analyses',
                '7. Critical Tasks',
                '8. Validation Testing',
                '9. Documentation',
                '10. Export & Review'
            ];

            const progress = (completedSections.size / 10) * 100;

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-blue-900 text-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl font-bold">FDA Human Factors Usability Report</h1>
                                    <p className="text-blue-200 text-sm">FDA-2011-D-0469 Guidance Compliance Tool</p>
                                </div>
                                <div className="flex items-center gap-4">
                                    {lastSaved && (
                                        <span className="text-sm text-blue-200">
                                            Saved: {new Date(lastSaved).toLocaleTimeString()}
                                        </span>
                                    )}
                                    <button onClick={handleSave} className="bg-blue-700 px-4 py-2 rounded hover:bg-blue-600">
                                        üíæ Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-6 py-8">
                        <div className="grid grid-cols-4 gap-6">
                            {/* Sidebar */}
                            <aside className="col-span-1">
                                <div className="bg-white rounded-lg shadow p-4 sticky top-4">
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Project Name</label>
                                        <input
                                            value={projectName}
                                            onChange={(e) => setProjectName(e.target.value)}
                                            className="w-full p-2 border rounded"
                                            placeholder="Project name"
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-1">Device Name</label>
                                        <input
                                            value={deviceName}
                                            onChange={(e) => setDeviceName(e.target.value)}
                                            className="w-full p-2 border rounded"
                                            placeholder="Device name"
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <div className="flex justify-between text-sm mb-1">
                                            <span>Progress</span>
                                            <span>{completedSections.size}/10</span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                            <div className="bg-blue-600 h-2 rounded-full" style={{width: `${progress}%`}}></div>
                                        </div>
                                    </div>
                                    <nav className="space-y-1">
                                        {sections.map((s, i) => (
                                            <button
                                                key={i}
                                                onClick={() => setSection(i + 1)}
                                                className={`w-full text-left p-2 rounded text-sm flex justify-between items-center ${
                                                    section === i + 1 ? 'bg-blue-100 text-blue-700 font-medium' : 'hover:bg-gray-100'
                                                }`}
                                            >
                                                <span>{s}</span>
                                                {completedSections.has(i + 1) && <span className="text-green-600">‚úì</span>}
                                            </button>
                                        ))}
                                    </nav>
                                    <button onClick={exportJSON} className="w-full mt-4 bg-gray-200 p-2 rounded hover:bg-gray-300">
                                        üì• Export JSON
                                    </button>
                                </div>
                            </aside>

                            {/* Main Content */}
                            <main className="col-span-3">
                                <div className="bg-white rounded-lg shadow p-6">
                                    <div className="flex justify-between items-start mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-900">{sections[section - 1]}</h2>
                                            <p className="text-sm text-gray-600 mt-1">FDA Guidance Section Requirements</p>
                                        </div>
                                        <button
                                            onClick={() => toggleComplete(section)}
                                            className={`px-4 py-2 rounded ${
                                                completedSections.has(section)
                                                    ? 'bg-green-100 text-green-700'
                                                    : 'bg-gray-100 text-gray-700'
                                            }`}
                                        >
                                            {completedSections.has(section) ? '‚úì Completed' : 'Mark Complete'}
                                        </button>
                                    </div>

                                    {/* Section 1: Conclusion */}
                                    {section === 1 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                                                <p className="text-sm"><strong>FDA Requirement:</strong> Provide conclusion that device is safe and effective for intended users, uses, and use environments.</p>
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">1.1 Safety & Effectiveness Statement</label>
                                                <textarea
                                                    value={safetyStatement}
                                                    onChange={(e) => setSafetyStatement(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px]"
                                                    placeholder="State that the device has been found to be safe and effective for the intended users, uses, and use environments..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">1.2 HFE/UE Process Summary</label>
                                                <textarea
                                                    value={processSummary}
                                                    onChange={(e) => setProcessSummary(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px]"
                                                    placeholder="Summarize the HFE/UE processes conducted (preliminary analyses, formative evaluations, design modifications, validation testing)..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">1.3 Residual Risk Discussion</label>
                                                <textarea
                                                    value={residualRisk}
                                                    onChange={(e) => setResidualRisk(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px]"
                                                    placeholder="Discuss any remaining use-related risks, why they cannot be further reduced, and why benefits outweigh risks..."
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {/* Section 2: Users, Uses, Environments */}
                                    {section === 2 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                                                <p className="text-sm"><strong>FDA Requirement:</strong> Describe all intended user groups, their characteristics, use environments, and expected training.</p>
                                            </div>
                                            <div>
                                                <div className="flex justify-between items-center mb-3">
                                                    <label className="font-medium">2.1 User Populations</label>
                                                    <button onClick={addUserGroup} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">+ Add User Group</button>
                                                </div>
                                                {userGroups.map((ug) => (
                                                    <div key={ug.id} className="border rounded p-4 mb-3">
                                                        <div className="flex justify-between mb-2">
                                                            <input
                                                                value={ug.name}
                                                                onChange={(e) => updateUserGroup(ug.id, 'name', e.target.value)}
                                                                className="font-medium p-2 border rounded flex-1 mr-2"
                                                                placeholder="User group name (e.g., Physicians, Nurses, Patients)"
                                                            />
                                                            <button onClick={() => removeUserGroup(ug.id)} className="text-red-600 px-2">‚úï</button>
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-3">
                                                            <input
                                                                value={ug.physical}
                                                                onChange={(e) => updateUserGroup(ug.id, 'physical', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                                placeholder="Physical capabilities (strength, dexterity)"
                                                            />
                                                            <input
                                                                value={ug.sensory}
                                                                onChange={(e) => updateUserGroup(ug.id, 'sensory', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                                placeholder="Sensory abilities (vision, hearing)"
                                                            />
                                                            <input
                                                                value={ug.cognitive}
                                                                onChange={(e) => updateUserGroup(ug.id, 'cognitive', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                                placeholder="Cognitive abilities (memory, attention)"
                                                            />
                                                            <input
                                                                value={ug.age}
                                                                onChange={(e) => updateUserGroup(ug.id, 'age', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                                placeholder="Age range"
                                                            />
                                                            <input
                                                                value={ug.experience}
                                                                onChange={(e) => updateUserGroup(ug.id, 'experience', e.target.value)}
                                                                className="p-2 border rounded text-sm col-span-2"
                                                                placeholder="Experience level with similar devices"
                                                            />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">2.3 Use Environments</label>
                                                <textarea
                                                    className="w-full p-3 border rounded min-h-[100px]"
                                                    placeholder="Describe use environments: hospital, home, transport, etc. Include lighting, noise, space constraints, distractions..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">2.4 Training</label>
                                                <textarea
                                                    value={trainingInfo}
                                                    onChange={(e) => setTrainingInfo(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[100px]"
                                                    placeholder="Expected training level, content, delivery method, duration, refresher frequency..."
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {/* Section 5: Risk Analysis */}
                                    {section === 5 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                                                <p className="text-sm"><strong>FDA Requirement:</strong> Identify use-related hazards, potential harm, severity, and risk control measures.</p>
                                            </div>
                                            <div>
                                                <div className="flex justify-between items-center mb-3">
                                                    <label className="font-medium">5.1 Use-Related Hazards</label>
                                                    <button onClick={addHazard} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">+ Add Hazard</button>
                                                </div>
                                                <div className="overflow-x-auto">
                                                    <table className="w-full border text-sm">
                                                        <thead className="bg-gray-100">
                                                            <tr>
                                                                <th className="border p-2">Use Error</th>
                                                                <th className="border p-2">Hazardous Situation</th>
                                                                <th className="border p-2">Potential Harm</th>
                                                                <th className="border p-2">Severity</th>
                                                                <th className="border p-2">Risk Controls</th>
                                                                <th className="border p-2">Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {hazards.map((h) => (
                                                                <tr key={h.id}>
                                                                    <td className="border p-1">
                                                                        <input
                                                                            value={h.useError}
                                                                            onChange={(e) => updateHazard(h.id, 'useError', e.target.value)}
                                                                            className="w-full p-1 text-sm"
                                                                            placeholder="e.g., Incorrect dosage entered"
                                                                        />
                                                                    </td>
                                                                    <td className="border p-1">
                                                                        <input
                                                                            value={h.hazard}
                                                                            onChange={(e) => updateHazard(h.id, 'hazard', e.target.value)}
                                                                            className="w-full p-1 text-sm"
                                                                            placeholder="e.g., Over/under medication"
                                                                        />
                                                                    </td>
                                                                    <td className="border p-1">
                                                                        <input
                                                                            value={h.harm}
                                                                            onChange={(e) => updateHazard(h.id, 'harm', e.target.value)}
                                                                            className="w-full p-1 text-sm"
                                                                            placeholder="e.g., Adverse drug reaction"
                                                                        />
                                                                    </td>
                                                                    <td className="border p-1">
                                                                        <select
                                                                            value={h.severity}
                                                                            onChange={(e) => updateHazard(h.id, 'severity', e.target.value)}
                                                                            className="w-full p-1 text-sm"
                                                                        >
                                                                            <option value="minor">Minor</option>
                                                                            <option value="moderate">Moderate</option>
                                                                            <option value="serious">Serious</option>
                                                                            <option value="catastrophic">Catastrophic</option>
                                                                        </select>
                                                                    </td>
                                                                    <td className="border p-1">
                                                                        <input
                                                                            value={h.controls}
                                                                            onChange={(e) => updateHazard(h.id, 'controls', e.target.value)}
                                                                            className="w-full p-1 text-sm"
                                                                            placeholder="Design controls implemented"
                                                                        />
                                                                    </td>
                                                                    <td className="border p-1 text-center">
                                                                        <button onClick={() => removeHazard(h.id)} className="text-red-600">‚úï</button>
                                                                    </td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Section 7: Critical Tasks */}
                                    {section === 7 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                                                <p className="text-sm"><strong>FDA Requirement:</strong> Identify and categorize all critical tasks that could result in use errors leading to harm.</p>
                                            </div>
                                            <div>
                                                <div className="flex justify-between items-center mb-3">
                                                    <label className="font-medium">7.1 Critical Tasks List</label>
                                                    <button onClick={addTask} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">+ Add Critical Task</button>
                                                </div>
                                                {criticalTasks.map((task) => (
                                                    <div key={task.id} className="border rounded p-4 mb-3">
                                                        <div className="flex justify-between mb-2">
                                                            <input
                                                                value={task.name}
                                                                onChange={(e) => updateTask(task.id, 'name', e.target.value)}
                                                                className="font-medium p-2 border rounded flex-1 mr-2"
                                                                placeholder="Task name (e.g., Program infusion rate)"
                                                            />
                                                            <button onClick={() => removeTask(task.id)} className="text-red-600 px-2">‚úï</button>
                                                        </div>
                                                        <textarea
                                                            value={task.description}
                                                            onChange={(e) => updateTask(task.id, 'description', e.target.value)}
                                                            className="w-full p-2 border rounded mb-2 text-sm"
                                                            placeholder="Detailed task description..."
                                                            rows="2"
                                                        />
                                                        <div className="grid grid-cols-2 gap-3">
                                                            <input
                                                                value={task.userGroup}
                                                                onChange={(e) => updateTask(task.id, 'userGroup', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                                placeholder="User group performing task"
                                                            />
                                                            <select
                                                                value={task.severity}
                                                                onChange={(e) => updateTask(task.id, 'severity', e.target.value)}
                                                                className="p-2 border rounded text-sm"
                                                            >
                                                                <option value="">Severity category</option>
                                                                <option value="minor">Minor</option>
                                                                <option value="moderate">Moderate</option>
                                                                <option value="serious">Serious</option>
                                                                <option value="catastrophic">Catastrophic</option>
                                                            </select>
                                                            <textarea
                                                                value={task.useErrors}
                                                                onChange={(e) => updateTask(task.id, 'useErrors', e.target.value)}
                                                                className="p-2 border rounded text-sm col-span-2"
                                                                placeholder="Potential use errors for this task..."
                                                                rows="2"
                                                            />
                                                            <textarea
                                                                value={task.harm}
                                                                onChange={(e) => updateTask(task.id, 'harm', e.target.value)}
                                                                className="p-2 border rounded text-sm col-span-2"
                                                                placeholder="Potential harm if use error occurs..."
                                                                rows="2"
                                                            />
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Section 8: Validation Testing */}
                                    {section === 8 && (
                                        <div className="space-y-6">
                                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                                                <p className="text-sm"><strong>FDA Requirement:</strong> Minimum 15 test participants per distinct user group. Document demographics, test protocol, and results.</p>
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">8.1 Test Participants</label>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="text-sm text-gray-600">Total Number (‚â•15 per user group)</label>
                                                        <input
                                                            type="number"
                                                            value={testParticipants}
                                                            onChange={(e) => setTestParticipants(e.target.value)}
                                                            className="w-full p-2 border rounded"
                                                            min="15"
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">8.2 Participant Demographics</label>
                                                <textarea
                                                    value={participantDemo}
                                                    onChange={(e) => setParticipantDemo(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[120px]"
                                                    placeholder="Age range, gender distribution, education levels, experience levels, medical conditions, physical/sensory/cognitive characteristics..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block font-medium mb-2">8.3 Test Results & Analysis</label>
                                                <textarea
                                                    value={testResults}
                                                    onChange={(e) => setTestResults(e.target.value)}
                                                    className="w-full p-3 border rounded min-h-[150px]"
                                                    placeholder="Task success rates, use errors observed, close calls, participant feedback, root cause analysis..."
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {/* Other sections placeholder */}
                                    {[3, 4, 6, 9, 10].includes(section) && (
                                        <div className="text-center py-12">
                                            <div className="text-gray-400 mb-4 text-6xl">üìã</div>
                                            <h3 className="text-xl font-medium text-gray-700 mb-2">{sections[section - 1]}</h3>
                                            <p className="text-gray-500 mb-6">This section will be expanded in future updates.</p>
                                            <textarea
                                                className="w-full max-w-2xl mx-auto p-3 border rounded min-h-[200px]"
                                                placeholder="Enter notes for this section..."
                                            />
                                        </div>
                                    )}

                                    {/* Navigation */}
                                    <div className="mt-8 pt-6 border-t flex justify-between">
                                        <button
                                            onClick={() => setSection(Math.max(1, section - 1))}
                                            disabled={section === 1}
                                            className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
                                        >
                                            ‚Üê Previous
                                        </button>
                                        <button
                                            onClick={() => setSection(Math.min(10, section + 1))}
                                            disabled={section === 10}
                                            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
                                        >
                                            Next ‚Üí
                                        </button>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
